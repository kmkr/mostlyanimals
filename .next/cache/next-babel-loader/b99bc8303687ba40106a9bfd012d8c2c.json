{"ast":null,"code":"import getWidth from \"./get-width\";\n\nfunction getNumPortrait(photos) {\n  return photos.filter(photo => photo.mode === \"portrait\").length;\n}\n\nexport default function (_photos) {\n  const photos = [..._photos];\n  const totalWidth = Math.min(getWidth(), 2560);\n  const groups = [];\n\n  while (photos.length) {\n    const subGroup = {\n      key: \"\",\n      height: null,\n      photos: []\n    };\n    let numThisRow = 3;\n    let portraitScaleFactor = 1;\n    let landscapeScaleFactor = 1;\n    const numNext5 = getNumPortrait(photos.slice(0, 5));\n\n    if (numNext5 && numNext5 < 5) {\n      const numNext4 = getNumPortrait(photos.slice(0, 4));\n      const numNext3 = getNumPortrait(photos.slice(0, 3));\n\n      if (numNext5 === 4) {\n        // ??\n        numThisRow = 5;\n      } else if (numNext5 === 3) {\n        numThisRow = 5;\n        portraitScaleFactor = 0.6;\n        landscapeScaleFactor = 1.3;\n      } else if (numNext4 === 2) {\n        numThisRow = 4;\n        portraitScaleFactor = 0.6;\n        landscapeScaleFactor = 1.35;\n      } else if (numNext3 === 1) {\n        portraitScaleFactor = 0.5;\n        landscapeScaleFactor = 1.2;\n      }\n    }\n\n    for (let i = 0; i < numThisRow; i++) {\n      const photoToAdd = photos.shift();\n\n      if (!photoToAdd) {\n        groups.push(subGroup);\n        return groups;\n      }\n\n      const scale = photoToAdd.mode === \"portrait\" ? portraitScaleFactor : landscapeScaleFactor;\n      const marginsInRow = (numThisRow + 1) * 8;\n      photoToAdd.displayedWidth = (totalWidth - marginsInRow) / numThisRow * scale;\n      subGroup.photos.push(photoToAdd);\n      subGroup.key += photoToAdd.key;\n      const ratio = photoToAdd.sizes.small.height / photoToAdd.sizes.small.width;\n      const height = photoToAdd.displayedWidth * ratio;\n      subGroup.height = subGroup.height ? Math.min(subGroup.height, height) : height; // next row\n    }\n\n    groups.push(subGroup);\n  }\n\n  return groups;\n}","map":null,"metadata":{},"sourceType":"module"}