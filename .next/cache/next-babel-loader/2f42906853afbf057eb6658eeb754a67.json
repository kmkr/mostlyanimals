{"ast":null,"code":"const listPhotos = require(\"./photos/list\");\n\nexport function getPhotoData() {\n  return listPhotos();\n}\nconst stopWords = [/\\d{4}/];\n\nfunction noStopWords(elem) {\n  return !stopWords.some(sw => sw.test(elem));\n}\n\nfunction onlyUnique(value, index, ary) {\n  return ary.indexOf(value) === index;\n}\n\nfunction reduceFlatten(a, b) {\n  return a.concat(b);\n}\n\nexport function getKeywordsForPhoto(photo) {\n  return [photo.title, ...(photo.location || \"\").split(\", \"), ...photo.tags].filter(noStopWords).filter(t => t).join(\", \");\n}\nexport function getAllKeywords() {\n  return getPhotoData().then(({\n    photos\n  }) => [\"diving\", \"scuba\", \"underwater\", \"photography\", \"fish\", \"nudibranch\", \"crab\", \"shrimp\", \"shark\", \"macro\", ...photos // Location tags are separated by commas - I want all such word groups to be candidates for unique filter so that \"The Philippines\", \"Pandan Island, The Philippines\" and \"Apo Reef, The Philippines\" ends up as three separate keywords \"Pandan Island\", \"Apo Reef\" and \"The Philippines\"\n  .map(p => (p.location || \"\").split(\", \")).reduce(reduceFlatten, []), ...photos.map(p => p.tags).reduce(reduceFlatten, []).filter(noStopWords)].filter(onlyUnique).filter(t => t).join(\", \"));\n}","map":{"version":3,"sources":["/home/km/git/splendid-nudibranch/server/view-data-service.js"],"names":["listPhotos","require","getPhotoData","stopWords","noStopWords","elem","some","sw","test","onlyUnique","value","index","ary","indexOf","reduceFlatten","a","b","concat","getKeywordsForPhoto","photo","title","location","split","tags","filter","t","join","getAllKeywords","then","photos","map","p","reduce"],"mappings":"AAAA,MAAMA,UAAU,GAAGC,OAAO,CAAC,eAAD,CAA1B;;AAEA,OAAO,SAASC,YAAT,GAAwB;AAC7B,SAAOF,UAAU,EAAjB;AACD;AAED,MAAMG,SAAS,GAAG,CAAC,OAAD,CAAlB;;AAEA,SAASC,WAAT,CAAqBC,IAArB,EAA2B;AACzB,SAAO,CAACF,SAAS,CAACG,IAAV,CAAgBC,EAAD,IAAQA,EAAE,CAACC,IAAH,CAAQH,IAAR,CAAvB,CAAR;AACD;;AAED,SAASI,UAAT,CAAoBC,KAApB,EAA2BC,KAA3B,EAAkCC,GAAlC,EAAuC;AACrC,SAAOA,GAAG,CAACC,OAAJ,CAAYH,KAAZ,MAAuBC,KAA9B;AACD;;AAED,SAASG,aAAT,CAAuBC,CAAvB,EAA0BC,CAA1B,EAA6B;AAC3B,SAAOD,CAAC,CAACE,MAAF,CAASD,CAAT,CAAP;AACD;;AAED,OAAO,SAASE,mBAAT,CAA6BC,KAA7B,EAAoC;AACzC,SAAO,CAACA,KAAK,CAACC,KAAP,EAAc,GAAG,CAACD,KAAK,CAACE,QAAN,IAAkB,EAAnB,EAAuBC,KAAvB,CAA6B,IAA7B,CAAjB,EAAqD,GAAGH,KAAK,CAACI,IAA9D,EACJC,MADI,CACGpB,WADH,EAEJoB,MAFI,CAEIC,CAAD,IAAOA,CAFV,EAGJC,IAHI,CAGC,IAHD,CAAP;AAID;AAED,OAAO,SAASC,cAAT,GAA0B;AAC/B,SAAOzB,YAAY,GAAG0B,IAAf,CAAoB,CAAC;AAAEC,IAAAA;AAAF,GAAD,KACzB,CACE,QADF,EAEE,OAFF,EAGE,YAHF,EAIE,aAJF,EAKE,MALF,EAME,YANF,EAOE,MAPF,EAQE,QARF,EASE,OATF,EAUE,OAVF,EAWE,GAAGA,MAAM,CACP;AADO,GAENC,GAFA,CAEKC,CAAD,IAAO,CAACA,CAAC,CAACV,QAAF,IAAc,EAAf,EAAmBC,KAAnB,CAAyB,IAAzB,CAFX,EAGAU,MAHA,CAGOlB,aAHP,EAGsB,EAHtB,CAXL,EAeE,GAAGe,MAAM,CACNC,GADA,CACKC,CAAD,IAAOA,CAAC,CAACR,IADb,EAEAS,MAFA,CAEOlB,aAFP,EAEsB,EAFtB,EAGAU,MAHA,CAGOpB,WAHP,CAfL,EAoBGoB,MApBH,CAoBUf,UApBV,EAqBGe,MArBH,CAqBWC,CAAD,IAAOA,CArBjB,EAsBGC,IAtBH,CAsBQ,IAtBR,CADK,CAAP;AAyBD","sourcesContent":["const listPhotos = require(\"./photos/list\");\n\nexport function getPhotoData() {\n  return listPhotos();\n}\n\nconst stopWords = [/\\d{4}/];\n\nfunction noStopWords(elem) {\n  return !stopWords.some((sw) => sw.test(elem));\n}\n\nfunction onlyUnique(value, index, ary) {\n  return ary.indexOf(value) === index;\n}\n\nfunction reduceFlatten(a, b) {\n  return a.concat(b);\n}\n\nexport function getKeywordsForPhoto(photo) {\n  return [photo.title, ...(photo.location || \"\").split(\", \"), ...photo.tags]\n    .filter(noStopWords)\n    .filter((t) => t)\n    .join(\", \");\n}\n\nexport function getAllKeywords() {\n  return getPhotoData().then(({ photos }) =>\n    [\n      \"diving\",\n      \"scuba\",\n      \"underwater\",\n      \"photography\",\n      \"fish\",\n      \"nudibranch\",\n      \"crab\",\n      \"shrimp\",\n      \"shark\",\n      \"macro\",\n      ...photos\n        // Location tags are separated by commas - I want all such word groups to be candidates for unique filter so that \"The Philippines\", \"Pandan Island, The Philippines\" and \"Apo Reef, The Philippines\" ends up as three separate keywords \"Pandan Island\", \"Apo Reef\" and \"The Philippines\"\n        .map((p) => (p.location || \"\").split(\", \"))\n        .reduce(reduceFlatten, []),\n      ...photos\n        .map((p) => p.tags)\n        .reduce(reduceFlatten, [])\n        .filter(noStopWords),\n    ]\n      .filter(onlyUnique)\n      .filter((t) => t)\n      .join(\", \")\n  );\n}\n"]},"metadata":{},"sourceType":"module"}